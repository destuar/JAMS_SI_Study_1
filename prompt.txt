You are helping with a research study aimed at the *Journal of the Academy of Marketing Science*.
We scraped ≈20 000 public Facebook comments posted within 30 days after four U.S. retailers
either **rolled back** or **kept** their Diversity‑Equity‑Inclusion (DEI) programs.
Each row has: company, post‑date, comment‑ID, parent‑ID (if it’s a reply),
raw text, reactions, and a flag (1 = kept DEI, 0 = rolled back).

Goals
------
1. **Classify each comment**  
   • Relevance to DEI (yes/no)  
   • Stance (pro‑DEI / anti‑DEI / neutral) – only if relevant  
   • Purchase intent (buy/support / boycott / neutral) – only if relevant  

2. **Estimate causal impact** of DEI decisions on weekly **boycott‑ and buy‑rates**,
   using a **Triple Difference (DDD)** panel model with brand fixed effects and an
   ex‑ante **brand‑authenticity score** as moderator.

Lean technology stack
---------------------
- Text pipeline & reproducibility: **spaCy v3.7 projects** [docs]&#8203;:contentReference[oaicite:0]{index=0}  
- Storage: **DuckDB** single‑file DB [docs]&#8203;:contentReference[oaicite:1]{index=1}  
- Thread features: **NetworkX** depth & root‑ID computation [docs]&#8203;:contentReference[oaicite:2]{index=2}  
- Few‑shot baseline + active learning: **SetFit** [blog]&#8203;:contentReference[oaicite:3]{index=3} and
  **small‑text** entropy sampling [GitHub]&#8203;:contentReference[oaicite:4]{index=4}  
- Final model: **DeBERTa‑v3‑large** with **LoRA/PEFT** for efficient fine‑tuning [model]&#8203;:contentReference[oaicite:5]{index=5} [guide]&#8203;:contentReference[oaicite:6]{index=6}  
- (Optional) augmentation: **GPT‑4o** synthetic comments, filtered by self‑critique.  
- Causal analysis: **Stata `didregress`** for DDD following current best‑practice guides [arXiv]&#8203;:contentReference[oaicite:7]{index=7}  
- Authenticity measure: recent **Brand‑Authenticity scale** [JAMS]&#8203;:contentReference[oaicite:8]{index=8}

High‑level workflow
-------------------
1. Import comments → build reply graph (`root_id`, `depth`).  
2. Clean text (URLs, emojis, lemmatisation) in spaCy project.  
3. Manually label 1 000 stratified comments; κ ≥ 0.75.  
4. Train SetFit; active‑learn uncertain comments until dev F1 ≥ 0.85/0.80.  
5. Fine‑tune DeBERTa‑LoRA with focal loss; 5‑fold CV by company.  
6. *Only if needed:* generate ≤ 1 synthetic example per real label, filter `ppl ≤ 100`, retrain.  
7. Predict all 20 k comments; aggregate weekly boycott & buy rates by stance.  
8. Run DDD: `rate ~ Rollback×Post×AntiStance (+ Authenticity interaction)`; robust SEs.  
9. Archive labels & code on OSF; cite **JAMS transparency guidelines** [Springer]&#8203;:contentReference[oaicite:9]{index=9} in manuscript.

Outcome
-------
This pipeline will quantify how **both** rolling back *and* keeping DEI
influence purchase intention among pro‑ and anti‑DEI commenters (the “go‑woke,
go‑broke” vs “rollback backlash” debate ) [news example]&#8203;:contentReference[oaicite:10]{index=10}, while testing
whether **brand authenticity buffers backlash**.
